<div class="profile-container">
  <mat-card appearance="outlined" class="profile-card">
    
    <mat-card-header>
      <mat-card-title>Edit Profile</mat-card-title>
      <mat-card-subtitle>Update your personal details</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      
      <div class="avatar-section">
        <div class="avatar-wrapper" (click)="fileInput.click()">
          
          @if (imagePreview()) {
            <img [src]="imagePreview()" alt="Profile Preview" class="avatar-image">
          } @else {
            <div class="avatar-placeholder">
              {{ profileForm.get('first_name')?.value?.charAt(0) || 'U' }}
            </div>
          }
          
          <div class="avatar-overlay">
            <mat-icon>camera_alt</mat-icon>
          </div>
        </div>
        <p class="avatar-hint">Click to upload new photo</p>
        
        <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
      </div>


      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">

        <h3 class="section-title">Personal Details</h3>
        
        <div class="form-grid two-col">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="first_name">
            @if (profileForm.get('first_name')?.hasError('required')) {
              <mat-error>First name is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="last_name">
            @if (profileForm.get('last_name')?.hasError('required')) {
              <mat-error>Last name is required</mat-error>
            }
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Date of Birth</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date_of_birth">
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          @if (profileForm.get('date_of_birth')?.hasError('required')) {
            <mat-error>Date of birth is required</mat-error>
          }
        </mat-form-field>


        <h3 class="section-title">Address</h3>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Address Line 1</mat-label>
          <input matInput formControlName="address_line_1" placeholder="123 Gym Street">
          @if (profileForm.get('address_line_1')?.hasError('required')) {
            <mat-error>Address is required</mat-error>
          }
        </mat-form-field>

        <div class="form-grid three-col">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city">
            @if (profileForm.get('city')?.hasError('required')) {
              <mat-error>Required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>State</mat-label>
            <input matInput formControlName="state">
            @if (profileForm.get('state')?.hasError('required')) {
              <mat-error>Required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Zip Code</mat-label>
            <input matInput formControlName="postal_code">
            @if (profileForm.get('postal_code')?.hasError('required')) {
              <mat-error>Required</mat-error>
            }
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Country Code</mat-label>
          <input matInput formControlName="country_code" placeholder="US" maxlength="2">
          <mat-hint align="end">{{ profileForm.get('country_code')?.value?.length || 0 }} / 2</mat-hint>
        </mat-form-field>

        <div class="form-actions">
          <button mat-flat-button color="primary" type="submit" 
                  class="save-btn"
                  [disabled]="profileForm.invalid || isLoading()">
            @if (isLoading()) {
              Saving...
            } @else {
              Save Changes
            }
          </button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>
</div>